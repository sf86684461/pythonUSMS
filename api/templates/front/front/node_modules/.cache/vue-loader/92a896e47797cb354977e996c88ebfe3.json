{"remainingRequest":"/Users/shaofeng/Desktop/pythonUSMS/api/templates/front/front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/shaofeng/Desktop/pythonUSMS/api/templates/front/front/src/components/img.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/shaofeng/Desktop/pythonUSMS/api/templates/front/front/src/components/img.vue","mtime":1757151569990},{"path":"/Users/shaofeng/Desktop/pythonUSMS/api/templates/front/front/node_modules/cache-loader/dist/cjs.js","mtime":1757151725167},{"path":"/Users/shaofeng/Desktop/pythonUSMS/api/templates/front/front/node_modules/babel-loader/lib/index.js","mtime":1757151725372},{"path":"/Users/shaofeng/Desktop/pythonUSMS/api/templates/front/front/node_modules/cache-loader/dist/cjs.js","mtime":1757151725167},{"path":"/Users/shaofeng/Desktop/pythonUSMS/api/templates/front/front/node_modules/vue-loader/lib/index.js","mtime":1757151725403}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKCW5hbWU6ICJYWFgiLAoJZGF0YSgpIHsKCQlyZXR1cm4gewoJCQliYXNlVXJsOiBgJHt0aGlzLiRjb25maWcuYmFzZVVybH1gLAoJCQl2aXNpYmxlOiBmYWxzZSwgLy/lvLnnqpcKCQkJbG9hZGluZzogZmFsc2UsIC8v5LiK5Lyg5oyJ6ZKu5Yqg6L29CgkJCW9zOiBmYWxzZSwgLy/mjqfliLbmkYTlg4/lpLTlvIDlhbMKCQkJdGhpc1ZpZGVvOiBudWxsLAoJCQl0aGlzQ29udGV4dDogbnVsbCwKCQkJdGhpc0NhbmNhczogbnVsbCwKCQkJdmlkZW9XaWR0aDogNTAwLAoJCQl2aWRlb0hlaWdodDogNDAwLAoJCQlwb3N0T3B0aW9uczogW10sCgkJCUNlcnRDdGw6ICcnLAoJCQkvLyDpga7nvanlsYIKCQkJbG9hZGluZzogdHJ1ZSwKCQkJLy8g6YCJ5Lit5pWw57uECgkJCWlkczogW10sCgkJCS8vIOmdnuWNleS4quemgeeUqAoJCQlzaW5nbGU6IHRydWUsCgkJCS8vIOmdnuWkmuS4quemgeeUqAoJCQltdWx0aXBsZTogdHJ1ZSwKCQkJLy8g5oC75p2h5pWwCgkJCXRvdGFsOiAwLAoJCQkvLyDpobnnm67kurrlkZjooajmoLzmlbDmja4KCQkJYWt3b3JrZXJMaXN0OiBbXSwKCQkJLy/lt6Xnp43nsbvliKvmlbDmja7lrZflhbgKCQkJd29ya2VyVHlwZU9wdGlvbnM6IFtdLAoJCQkvLyDlvLnlh7rlsYLmoIfpopgKCQkJdGl0bGU6ICIiLAoJCQkvLyDmmK/lkKbmmL7npLrlvLnlh7rlsYIKCQkJb3BlbjogZmFsc2UsCgkJCS8vIOafpeivouWPguaVsAoJCQlxdWVyeVBhcmFtczogewoJCQkJcGFnZU51bTogMSwKCQkJCXBhZ2VTaXplOiAxMCwKCQkJCWltZ1NyYzogdW5kZWZpbmVkLAoJCQl9LAoJCQkvLyDooajljZXlj4LmlbAKCgkJCWZvcm06IHt9LAoKCQkJLy8g6KGo5Y2V5qCh6aqMCgoJCQlydWxlczogewoKCQkJfQoKCQl9OwoKCX0sCgljb21wdXRlZDogewoJCS8vIOiuoeeul+WxnuaAp+eahCBnZXR0ZXIKCQlnZXRBY3Rpb25Vcmw6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gdGhpcy5iYXNlVXJsICsgJ2ZpbGUvdXBsb2FkJzsKCQl9Cgl9LAoJY3JlYXRlZCgpIHsKCQkvLyB0aGlzLm9uVGFrZSgpCgl9LAoKCW1ldGhvZHM6IHsKCgkJLyrosIPnlKjmkYTlg4/lpLTmi43nhaflvIDlp4sqLwoKCQlvblRha2UoKSB7CgoJCQl0aGlzLnZpc2libGUgPSB0cnVlOwoKCQkJdGhpcy5nZXRDb21wZXRlbmNlKCk7CgoJCX0sCgoJCW9uQ2FuY2VsKCkgewoJCQl0aGlzLnVwbG9hZEltZygpCgkJCXRoaXMudmlzaWJsZSA9IGZhbHNlOwoJCQkvKiB0aGlzLnJlc2V0Q2FudmFzKCk7Ki8KCgkJCXRoaXMuc3RvcE5hdmlnYXRvcigpOwoKCQl9LAoJCXVwbG9hZFN1Y2Nlc3MoZSkgewoJCQl0aGlzLnZpc2libGUgPSBmYWxzZTsKCQkJdGhpcy4kZW1pdCgnaW1nQ2hhbmdlJywgZS5maWxlKQoJCX0sCgkJdXBsb2FkSW1nKCkgewoJCQlsZXQgcGFyYW0gPSBuZXcgRm9ybURhdGEoKQoJCQlwYXJhbS5hcHBlbmQoJ2ZpbGUnLCB0aGlzLmJhc2U2NHRvRmlsZSh0aGlzLmltZ1NyYykpCgkJCXRoaXMuJGh0dHAucG9zdCgnZmlsZS91cGxvYWQnLCBwYXJhbSkudGhlbihyZXMgPT4gewoJCQkJdGhpcy4kZW1pdCgnaW1nQ2hhbmdlJywgcmVzLmRhdGEuZmlsZSkKCQkJfSkKCQl9LAoJCWJhc2U2NHRvRmlsZShkYXRhdXJsLCBmaWxlbmFtZSA9ICdmaWxlJykgewoJCQlsZXQgYXJyID0gZGF0YXVybC5zcGxpdCgnLCcpCgkJCWxldCBtaW1lID0gYXJyWzBdLm1hdGNoKC86KC4qPyk7LylbMV0KCQkJbGV0IHN1ZmZpeCA9IG1pbWUuc3BsaXQoJy8nKVsxXQoJCQlsZXQgYnN0ciA9IGF0b2IoYXJyWzFdKQoJCQlsZXQgbiA9IGJzdHIubGVuZ3RoCgkJCWxldCB1OGFyciA9IG5ldyBVaW50OEFycmF5KG4pCgkJCXdoaWxlIChuLS0pIHsKCQkJCXU4YXJyW25dID0gYnN0ci5jaGFyQ29kZUF0KG4pCgkJCX0KCQkJbGV0IGZpbGUgPSBuZXcgRmlsZShbdThhcnJdLCBgJHtmaWxlbmFtZX0uJHtzdWZmaXh9YCwgewoJCQkJdHlwZTogbWltZQoJCQl9KQoJCQlyZXR1cm4gZmlsZQoJCX0sCgkJLy8g6LCD55So5pGE5YOP5aS05p2D6ZmQCgoJCWdldENvbXBldGVuY2UoKSB7CgoJCQkvL+W/hemhu+WcqG1vZGVs5LitcmVuZGVy5ZCO5omN5Y+v6I635Y+W5YiwZG9t6IqC54K5LOebtOaOpeiOt+WPluaXoOazleiOt+WPluWIsG1vZGVs5Lit55qEZG9t6IqC54K5CgoJCQl0aGlzLiRuZXh0VGljaygoKSA9PiB7CgoJCQkJY29uc3QgX3RoaXMgPSB0aGlzOwoKCQkJCXRoaXMub3MgPSBmYWxzZTsgLy/liIfmjaLmiJDlhbPpl63mkYTlg4/lpLQKCgkJCQl0aGlzLnRoaXNDYW5jYXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzQ2FtZXJhJyk7CgoJCQkJdGhpcy50aGlzQ29udGV4dCA9IHRoaXMudGhpc0NhbmNhcy5nZXRDb250ZXh0KCcyZCcpOwoKCQkJCXRoaXMudGhpc1ZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZGVvQ2FtZXJhJyk7CgoJCQkJLy8g5pen54mI5pys5rWP6KeI5Zmo5Y+v6IO95qC55pys5LiN5pSv5oyBbWVkaWFEZXZpY2Vz77yM5oiR5Lus6aaW5YWI6K6+572u5LiA5Liq56m65a+56LGhCgoJCQkJaWYgKG5hdmlnYXRvci5tZWRpYURldmljZXMgPT09IHVuZGVmaW5lZCkgewoKCQkJCQluYXZpZ2F0b3IubWVuYXZpZ2F0b3JkaWFEZXZpY2VzID0ge30KCgkJCQl9CgoJCQkJLy8g5LiA5Lqb5rWP6KeI5Zmo5a6e546w5LqG6YOo5YiGbWVkaWFEZXZpY2Vz77yM5oiR5Lus5LiN6IO95Y+q5YiG6YWN5LiA5Liq5a+56LGhCgoJCQkJLy8g5L2/55SoZ2V0VXNlck1lZGlh77yM5Zug5Li65a6D5Lya6KaG55uW546w5pyJ55qE5bGe5oCn44CCCgoJCQkJLy8g6L+Z6YeM77yM5aaC5p6c57y65bCRZ2V0VXNlck1lZGlh5bGe5oCn77yM5bCx5re75Yqg5a6D44CCCgoJCQkJaWYgKG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhID09PSB1bmRlZmluZWQpIHsKCgkJCQkJbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEgPSBmdW5jdGlvbihjb25zdHJhaW50cykgewoKCQkJCQkJLy8g6aaW5YWI6I635Y+W546w5a2Y55qEZ2V0VXNlck1lZGlhKOWmguaenOWtmOWcqCkKCgkJCQkJCWxldCBnZXRVc2VyTWVkaWEgPSBuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhIHx8IG5hdmlnYXRvci5tb3pHZXRVc2VyTWVkaWEgfHwKCQkJCQkJCW5hdmlnYXRvcgoJCQkJCQkJLmdldFVzZXJNZWRpYTsKCgkJCQkJCS8vIOacieS6m+a1j+iniOWZqOS4jeaUr+aMge+8jOS8mui/lOWbnumUmeivr+S/oeaBrwoKCQkJCQkJLy8g5L+d5oyB5o6l5Y+j5LiA6Ie0CgoJCQkJCQlpZiAoIWdldFVzZXJNZWRpYSkgewoKCQkJCQkJCXJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoCgkJCQkJCQkJJ2dldFVzZXJNZWRpYSBpcyBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBicm93c2VyJykpCgoJCQkJCQl9CgoJCQkJCQkvLyDlkKbliJnvvIzkvb/nlKhQcm9taXNl5bCG6LCD55So5YyF6KOF5Yiw5pen55qEbmF2aWdhdG9yLmdldFVzZXJNZWRpYQoKCQkJCQkJcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewoKCQkJCQkJCWdldFVzZXJNZWRpYS5jYWxsKG5hdmlnYXRvciwgY29uc3RyYWludHMsIHJlc29sdmUsIHJlamVjdCkKCgkJCQkJCX0pCgoJCQkJCX0KCgkJCQl9CgoJCQkJY29uc3QgY29uc3RyYWludHMgPSB7CgoJCQkJCWF1ZGlvOiBmYWxzZSwKCgkJCQkJdmlkZW86IHsKCQkJCQkJd2lkdGg6IF90aGlzLnZpZGVvV2lkdGgsCgkJCQkJCWhlaWdodDogX3RoaXMudmlkZW9IZWlnaHQsCgkJCQkJCXRyYW5zZm9ybTogJ3NjYWxlWCgtMSknCgkJCQkJfQoKCQkJCX07CgoJCQkJbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpLnRoZW4oZnVuY3Rpb24oc3RyZWFtKSB7CgoJCQkJCS8vIOaXp+eahOa1j+iniOWZqOWPr+iDveayoeaciXNyY09iamVjdAoKCQkJCQlpZiAoJ3NyY09iamVjdCcgaW4gX3RoaXMudGhpc1ZpZGVvKSB7CgoJCQkJCQlfdGhpcy50aGlzVmlkZW8uc3JjT2JqZWN0ID0gc3RyZWFtCgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyDpgb/lhY3lnKjmlrDnmoTmtY/op4jlmajkuK3kvb/nlKjlroPvvIzlm6DkuLrlroPmraPlnKjooqvlvIPnlKjjgIIKCgkJCQkJCV90aGlzLnRoaXNWaWRlby5zcmMgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChzdHJlYW0pCgoJCQkJCX0KCgkJCQkJX3RoaXMudGhpc1ZpZGVvLm9ubG9hZGVkbWV0YWRhdGEgPSBmdW5jdGlvbihlKSB7CgoJCQkJCQlfdGhpcy50aGlzVmlkZW8ucGxheSgpCgoJCQkJCX0KCgkJCQl9KS5jYXRjaChlcnIgPT4gewoKCQkJCQl0aGlzLiRub3RpZnkoewoKCQkJCQkJdGl0bGU6ICforablkYonLAoKCQkJCQkJbWVzc2FnZTogJ+ayoeacieW8gOWQr+aRhOWDj+WktOadg+mZkOaIlua1j+iniOWZqOeJiOacrOS4jeWFvOWuuS4nLAoKCQkJCQkJdHlwZTogJ3dhcm5pbmcnCgoJCQkJCX0pOwoKCQkJCX0pOwoKCQkJfSk7CgoJCX0sCgoJCS8v57uY5Yi25Zu+54mHCgoJCWRyYXdJbWFnZSgpIHsKCgkJCS8vIOeCueWHu++8jGNhbnZhc+eUu+WbvgoKCQkJdGhpcy50aGlzQ29udGV4dC5kcmF3SW1hZ2UodGhpcy50aGlzVmlkZW8sIDAsIDAsIHRoaXMudmlkZW9XaWR0aCwgdGhpcy52aWRlb0hlaWdodCk7CgoJCQkvLyDojrflj5blm77niYdiYXNlNjTpk77mjqUKCgkJCXRoaXMuaW1nU3JjID0gdGhpcy50aGlzQ2FuY2FzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7CgoJCQkvKmNvbnN0IGltZ1NyYz10aGlzLmltZ1NyYzsqLwoKCQl9LAoKCQkvL+a4heepuueUu+W4gwoKCQljbGVhckNhbnZhcyhpZCkgewoKCQkJbGV0IGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CgoJCQlsZXQgY3h0ID0gYy5nZXRDb250ZXh0KCIyZCIpOwoKCQkJY3h0LmNsZWFyUmVjdCgwLCAwLCBjLndpZHRoLCBjLmhlaWdodCk7CgoJCX0sCgoJCS8v6YeN572u55S75biDCgoJCXJlc2V0Q2FudmFzKCkgewoKCQkJdGhpcy5pbWdTcmMgPSAiIjsKCgkJCXRoaXMuY2xlYXJDYW52YXMoJ2NhbnZhc0NhbWVyYScpOwoKCQl9LAoKCQkvL+WFs+mXreaRhOWDj+WktAoKCQlzdG9wTmF2aWdhdG9yKCkgewoKCQkJaWYgKHRoaXMudGhpc1ZpZGVvICYmIHRoaXMudGhpc1ZpZGVvICE9PSBudWxsKSB7CgoJCQkJdGhpcy50aGlzVmlkZW8uc3JjT2JqZWN0LmdldFRyYWNrcygpWzBdLnN0b3AoKTsKCgkJCQl0aGlzLm9zID0gdHJ1ZTsgLy/liIfmjaLmiJDmiZPlvIDmkYTlg4/lpLQKCgkJCX0KCgkJfSwKCgkJLyrosIPnlKjmkYTlg4/lpLTmi43nhafnu5PmnZ8qLwoKCX0KCn07Cg=="},{"version":3,"sources":["img.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA","file":"img.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n\t<el-dialog title=\"拍照上传\" :visible.sync=\"visible\" width=\"1065px\">\r\n\t\t<div class=\"box\">\r\n\t\t\t<video id=\"videoCamera\" class=\"canvas\" :width=\"videoWidth\" :height=\"videoHeight\" autoPlay></video>\r\n\t\t\t<canvas id=\"canvasCamera\" class=\"canvas\" :width=\"videoWidth\" :height=\"videoHeight\"></canvas>\r\n\t\t</div>\r\n\t\t<div slot=\"footer\" style=\"display:flex\">\r\n\t\t\t<el-upload :action=\"getActionUrl\" :on-success=\"uploadSuccess\" :show-file-list=\"false\"\r\n\t\t\t\taccept=\".jpg,.png,.jpge\" style=\"margin-right:10px\">\r\n\t\t\t\t<el-button icon=\"el-icon-upload2\" size=\"small\">\r\n\t\t\t\t\t上传图片\r\n\t\t\t\t</el-button>\r\n\t\t\t</el-upload>\r\n\r\n\t\t\t<el-button @click=\"drawImage\" icon=\"el-icon-camera\" size=\"small\">\r\n\t\t\t\t拍照\r\n\t\t\t</el-button>\r\n\t\t\t<el-button v-if=\"os\" @click=\"getCompetence\" icon=\"el-icon-video-camera\" size=\"small\">\r\n\t\t\t\t打开摄像头\r\n\t\t\t</el-button>\r\n\t\t\t<el-button v-else @click=\"stopNavigator\" icon=\"el-icon-switch-button\" size=\"small\">\r\n\t\t\t\t关闭摄像头\r\n\t\t\t</el-button>\r\n\t\t\t<el-button @click=\"resetCanvas\" icon=\"el-icon-refresh\" size=\"small\">\r\n\t\t\t\t重置\r\n\t\t\t</el-button>\r\n\t\t\t<el-button @click=\"onCancel\" icon=\"el-icon-circle-close\" size=\"small\">\r\n\t\t\t\t完成\r\n\t\t\t</el-button>\r\n\t\t</div>\r\n\t</el-dialog>\r\n</template>\r\n<script>\r\n\texport default {\r\n\t\tname: \"XXX\",\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tbaseUrl: `${this.$config.baseUrl}`,\r\n\t\t\t\tvisible: false, //弹窗\r\n\t\t\t\tloading: false, //上传按钮加载\r\n\t\t\t\tos: false, //控制摄像头开关\r\n\t\t\t\tthisVideo: null,\r\n\t\t\t\tthisContext: null,\r\n\t\t\t\tthisCancas: null,\r\n\t\t\t\tvideoWidth: 500,\r\n\t\t\t\tvideoHeight: 400,\r\n\t\t\t\tpostOptions: [],\r\n\t\t\t\tCertCtl: '',\r\n\t\t\t\t// 遮罩层\r\n\t\t\t\tloading: true,\r\n\t\t\t\t// 选中数组\r\n\t\t\t\tids: [],\r\n\t\t\t\t// 非单个禁用\r\n\t\t\t\tsingle: true,\r\n\t\t\t\t// 非多个禁用\r\n\t\t\t\tmultiple: true,\r\n\t\t\t\t// 总条数\r\n\t\t\t\ttotal: 0,\r\n\t\t\t\t// 项目人员表格数据\r\n\t\t\t\takworkerList: [],\r\n\t\t\t\t//工种类别数据字典\r\n\t\t\t\tworkerTypeOptions: [],\r\n\t\t\t\t// 弹出层标题\r\n\t\t\t\ttitle: \"\",\r\n\t\t\t\t// 是否显示弹出层\r\n\t\t\t\topen: false,\r\n\t\t\t\t// 查询参数\r\n\t\t\t\tqueryParams: {\r\n\t\t\t\t\tpageNum: 1,\r\n\t\t\t\t\tpageSize: 10,\r\n\t\t\t\t\timgSrc: undefined,\r\n\t\t\t\t},\r\n\t\t\t\t// 表单参数\r\n\r\n\t\t\t\tform: {},\r\n\r\n\t\t\t\t// 表单校验\r\n\r\n\t\t\t\trules: {\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t// 计算属性的 getter\r\n\t\t\tgetActionUrl: function() {\r\n\t\t\t\treturn this.baseUrl + 'file/upload';\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\t// this.onTake()\r\n\t\t},\r\n\r\n\t\tmethods: {\r\n\r\n\t\t\t/*调用摄像头拍照开始*/\r\n\r\n\t\t\tonTake() {\r\n\r\n\t\t\t\tthis.visible = true;\r\n\r\n\t\t\t\tthis.getCompetence();\r\n\r\n\t\t\t},\r\n\r\n\t\t\tonCancel() {\r\n\t\t\t\tthis.uploadImg()\r\n\t\t\t\tthis.visible = false;\r\n\t\t\t\t/* this.resetCanvas();*/\r\n\r\n\t\t\t\tthis.stopNavigator();\r\n\r\n\t\t\t},\r\n\t\t\tuploadSuccess(e) {\r\n\t\t\t\tthis.visible = false;\r\n\t\t\t\tthis.$emit('imgChange', e.file)\r\n\t\t\t},\r\n\t\t\tuploadImg() {\r\n\t\t\t\tlet param = new FormData()\r\n\t\t\t\tparam.append('file', this.base64toFile(this.imgSrc))\r\n\t\t\t\tthis.$http.post('file/upload', param).then(res => {\r\n\t\t\t\t\tthis.$emit('imgChange', res.data.file)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tbase64toFile(dataurl, filename = 'file') {\r\n\t\t\t\tlet arr = dataurl.split(',')\r\n\t\t\t\tlet mime = arr[0].match(/:(.*?);/)[1]\r\n\t\t\t\tlet suffix = mime.split('/')[1]\r\n\t\t\t\tlet bstr = atob(arr[1])\r\n\t\t\t\tlet n = bstr.length\r\n\t\t\t\tlet u8arr = new Uint8Array(n)\r\n\t\t\t\twhile (n--) {\r\n\t\t\t\t\tu8arr[n] = bstr.charCodeAt(n)\r\n\t\t\t\t}\r\n\t\t\t\tlet file = new File([u8arr], `${filename}.${suffix}`, {\r\n\t\t\t\t\ttype: mime\r\n\t\t\t\t})\r\n\t\t\t\treturn file\r\n\t\t\t},\r\n\t\t\t// 调用摄像头权限\r\n\r\n\t\t\tgetCompetence() {\r\n\r\n\t\t\t\t//必须在model中render后才可获取到dom节点,直接获取无法获取到model中的dom节点\r\n\r\n\t\t\t\tthis.$nextTick(() => {\r\n\r\n\t\t\t\t\tconst _this = this;\r\n\r\n\t\t\t\t\tthis.os = false; //切换成关闭摄像头\r\n\r\n\t\t\t\t\tthis.thisCancas = document.getElementById('canvasCamera');\r\n\r\n\t\t\t\t\tthis.thisContext = this.thisCancas.getContext('2d');\r\n\r\n\t\t\t\t\tthis.thisVideo = document.getElementById('videoCamera');\r\n\r\n\t\t\t\t\t// 旧版本浏览器可能根本不支持mediaDevices，我们首先设置一个空对象\r\n\r\n\t\t\t\t\tif (navigator.mediaDevices === undefined) {\r\n\r\n\t\t\t\t\t\tnavigator.menavigatordiaDevices = {}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 一些浏览器实现了部分mediaDevices，我们不能只分配一个对象\r\n\r\n\t\t\t\t\t// 使用getUserMedia，因为它会覆盖现有的属性。\r\n\r\n\t\t\t\t\t// 这里，如果缺少getUserMedia属性，就添加它。\r\n\r\n\t\t\t\t\tif (navigator.mediaDevices.getUserMedia === undefined) {\r\n\r\n\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia = function(constraints) {\r\n\r\n\t\t\t\t\t\t\t// 首先获取现存的getUserMedia(如果存在)\r\n\r\n\t\t\t\t\t\t\tlet getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia ||\r\n\t\t\t\t\t\t\t\tnavigator\r\n\t\t\t\t\t\t\t\t.getUserMedia;\r\n\r\n\t\t\t\t\t\t\t// 有些浏览器不支持，会返回错误信息\r\n\r\n\t\t\t\t\t\t\t// 保持接口一致\r\n\r\n\t\t\t\t\t\t\tif (!getUserMedia) {\r\n\r\n\t\t\t\t\t\t\t\treturn Promise.reject(new Error(\r\n\t\t\t\t\t\t\t\t\t'getUserMedia is not implemented in this browser'))\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// 否则，使用Promise将调用包装到旧的navigator.getUserMedia\r\n\r\n\t\t\t\t\t\t\treturn new Promise(function(resolve, reject) {\r\n\r\n\t\t\t\t\t\t\t\tgetUserMedia.call(navigator, constraints, resolve, reject)\r\n\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst constraints = {\r\n\r\n\t\t\t\t\t\taudio: false,\r\n\r\n\t\t\t\t\t\tvideo: {\r\n\t\t\t\t\t\t\twidth: _this.videoWidth,\r\n\t\t\t\t\t\t\theight: _this.videoHeight,\r\n\t\t\t\t\t\t\ttransform: 'scaleX(-1)'\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tnavigator.mediaDevices.getUserMedia(constraints).then(function(stream) {\r\n\r\n\t\t\t\t\t\t// 旧的浏览器可能没有srcObject\r\n\r\n\t\t\t\t\t\tif ('srcObject' in _this.thisVideo) {\r\n\r\n\t\t\t\t\t\t\t_this.thisVideo.srcObject = stream\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t// 避免在新的浏览器中使用它，因为它正在被弃用。\r\n\r\n\t\t\t\t\t\t\t_this.thisVideo.src = window.URL.createObjectURL(stream)\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_this.thisVideo.onloadedmetadata = function(e) {\r\n\r\n\t\t\t\t\t\t\t_this.thisVideo.play()\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}).catch(err => {\r\n\r\n\t\t\t\t\t\tthis.$notify({\r\n\r\n\t\t\t\t\t\t\ttitle: '警告',\r\n\r\n\t\t\t\t\t\t\tmessage: '没有开启摄像头权限或浏览器版本不兼容.',\r\n\r\n\t\t\t\t\t\t\ttype: 'warning'\r\n\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t},\r\n\r\n\t\t\t//绘制图片\r\n\r\n\t\t\tdrawImage() {\r\n\r\n\t\t\t\t// 点击，canvas画图\r\n\r\n\t\t\t\tthis.thisContext.drawImage(this.thisVideo, 0, 0, this.videoWidth, this.videoHeight);\r\n\r\n\t\t\t\t// 获取图片base64链接\r\n\r\n\t\t\t\tthis.imgSrc = this.thisCancas.toDataURL('image/png');\r\n\r\n\t\t\t\t/*const imgSrc=this.imgSrc;*/\r\n\r\n\t\t\t},\r\n\r\n\t\t\t//清空画布\r\n\r\n\t\t\tclearCanvas(id) {\r\n\r\n\t\t\t\tlet c = document.getElementById(id);\r\n\r\n\t\t\t\tlet cxt = c.getContext(\"2d\");\r\n\r\n\t\t\t\tcxt.clearRect(0, 0, c.width, c.height);\r\n\r\n\t\t\t},\r\n\r\n\t\t\t//重置画布\r\n\r\n\t\t\tresetCanvas() {\r\n\r\n\t\t\t\tthis.imgSrc = \"\";\r\n\r\n\t\t\t\tthis.clearCanvas('canvasCamera');\r\n\r\n\t\t\t},\r\n\r\n\t\t\t//关闭摄像头\r\n\r\n\t\t\tstopNavigator() {\r\n\r\n\t\t\t\tif (this.thisVideo && this.thisVideo !== null) {\r\n\r\n\t\t\t\t\tthis.thisVideo.srcObject.getTracks()[0].stop();\r\n\r\n\t\t\t\t\tthis.os = true; //切换成打开摄像头\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\t/*调用摄像头拍照结束*/\r\n\r\n\t\t}\r\n\r\n\t};\r\n</script>\r\n<style rel=\"stylesheet/scss\" lang=\"scss\" scoped>\r\n\t.avatar-uploader .el-upload {\r\n\t\tborder: 1px dashed #ccc;\r\n\t\tborder-radius: 6px;\r\n\t\tcursor: pointer;\r\n\t\tposition: relative;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.avatar-uploader .el-upload:hover {\r\n\t\tborder-color: #409EFF;\r\n\t}\r\n\r\n\t.avatar-uploader-icon {\r\n\t\tfont-size: 28px;\r\n\t\tcolor: #8c939d;\r\n\t\twidth: 178px;\r\n\t\theight: 178px;\r\n\t\tline-height: 178px;\r\n\t\ttext-align: center;\r\n\t\tborder: 1px dashed #ccc;\r\n\t}\r\n\r\n\t.avatar {\r\n\t\twidth: 178px;\r\n\t\theight: 178px;\r\n\t\tdisplay: block;\r\n\t}\r\n</style>"]}]}